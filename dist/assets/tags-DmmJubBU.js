import{a7 as S,a8 as f,c as T,r as b,j as s,a0 as R,a1 as d,a3 as C,a4 as $,I as h,P as L,N,O as E,Q as D,a9 as G,aa as Q,G as r,T as q,av as B,B as _,ab as F,R as g,h as v,aw as U,af as K,D as V,ag as H,a5 as A}from"./index-DXEjXkez.js";import{u as J}from"./useGetTags-CXGUoUDx.js";const M=()=>{const e=S();return f({mutationFn:async n=>(await T.delete(`/tags/${n}`)).data,onSuccess:()=>{e.invalidateQueries({queryKey:["tags"]})}})};function X({row:e,selected:n,onEdit:i}){const[u,t]=b.useState(null),{mutate:p,isPending:a}=M(),l=b.useCallback(o=>{t(o.currentTarget)},[]),x=b.useCallback(()=>{t(null)},[]),c=()=>{confirm("Sei sicuro di voler eliminare questo tag?")&&p(e.id)},j=()=>{x(),i(e)};return s.jsxs(s.Fragment,{children:[s.jsxs(R,{hover:!0,tabIndex:-1,role:"checkbox",selected:n,children:[s.jsx(d,{children:e.id}),s.jsx(d,{children:e.id_w||"-"}),s.jsx(d,{children:e.name}),s.jsx(d,{children:e.slug}),s.jsx(d,{children:e.id_w?s.jsx(C,{color:"info",children:"SI ✓"}):s.jsx(C,{color:"error",children:"NO ⚠"})}),s.jsx(d,{children:e.last_sync?s.jsxs(C,{color:e.last_sync.stato==="successo"?"success":"error",children:["Sync-",e.last_sync.id]}):"-"}),s.jsx(d,{children:s.jsx($,{onClick:l,children:s.jsx(h,{icon:"eva:more-vertical-fill"})})})]}),s.jsx(L,{open:!!u,anchorEl:u,onClose:x,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"right"},children:s.jsxs(N,{disablePadding:!0,sx:{p:.5,gap:.5,width:140,display:"flex",flexDirection:"column",[`& .${E.root}`]:{px:1,gap:2,borderRadius:.75,[`&.${E.selected}`]:{bgcolor:"action.selected"}}},children:[s.jsxs(D,{onClick:j,children:[s.jsx(h,{icon:"solar:pen-bold"}),"Modifica"]}),s.jsx(D,{onClick:c,sx:{color:"error.main"},children:a?s.jsx(G,{size:20}):s.jsxs(s.Fragment,{children:[s.jsx(h,{icon:"solar:trash-bin-trash-bold"}),"Elimina"]})})]})})]})}function k(){const e=S();return f({mutationFn:async n=>{const{data:i}=await T.post("/tags",n);return i},onSuccess:n=>{e.invalidateQueries({queryKey:["tags"]})}})}function Y(){const e=S();return f({mutationFn:async n=>{const{data:i}=await T.put(`/tags/${n.id}`,n);return i},onSuccess:n=>{e.invalidateQueries({queryKey:["tags"]})}})}function Z({tag:e,onSubmit:n}){k();const{register:i,handleSubmit:u,formState:{errors:t},setValue:p}=Q({defaultValues:{name:(e==null?void 0:e.name)||"",slug:(e==null?void 0:e.slug)||"",id:(e==null?void 0:e.id)||"",id_w:(e==null?void 0:e.id_w)||"",created_at:(e==null?void 0:e.created_at)||"",last_sync:(e==null?void 0:e.last_sync)||""}}),{mutate:a,isPending:l}=k(),{mutate:x,isPending:c}=Y(),j=async o=>{e?x({...e,...o},{onSuccess:()=>n(o),onError:m=>{console.error("Errore durante il salvataggio del tag:",m)}}):a(o,{onSuccess:()=>n(o),onError:m=>{console.error("Errore durante il salvataggio del tag:",m)}})};return s.jsx("form",{onSubmit:u(j),children:s.jsxs(r,{container:!0,spacing:2,sx:{mt:.5},children:[(e==null?void 0:e.created_at)&&s.jsx(r,{item:!0,xs:12,children:s.jsxs(q,{variant:"body2",color:"textSecondary",children:["Data di creazione: ",B(new Date(e.created_at),"dd/MM/yyyy HH:mm",{locale:U})]})}),e&&s.jsx(s.Fragment,{children:s.jsx(r,{item:!0,xs:12,mb:2,children:s.jsxs(_,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:[(e==null?void 0:e.last_sync)&&s.jsx(F,{sx:{width:"100%"},title:`Ultimo Sync: ${e.last_sync.id}`,subtitle:`Data: ${e.last_sync.created_at}`,color:"primary"}),(e==null?void 0:e.id_w)&&s.jsx(F,{sx:{width:"100%"},title:`Caricato su WooCommerce: ${e.id_w?"SI":"NO"}`,color:"success"})]})})}),(e==null?void 0:e.id)&&s.jsxs(s.Fragment,{children:[s.jsx(r,{item:!0,xs:6,children:s.jsx(g,{fullWidth:!0,label:"ID",value:e.id,disabled:!0})}),s.jsx(r,{item:!0,xs:6,children:s.jsx(g,{fullWidth:!0,label:"ID_W",value:e.id_w,disabled:!0})})]}),s.jsx(r,{item:!0,xs:12,children:s.jsx(g,{fullWidth:!0,label:"Nome",...i("name",{required:!0}),error:!!t.name,helperText:t.name&&"Il nome è obbligatorio",required:!0})}),(e==null?void 0:e.id)&&s.jsx(r,{item:!0,xs:12,children:s.jsx(g,{fullWidth:!0,label:"Slug",...i("slug",{required:!0})})}),s.jsx(r,{item:!0,xs:12,children:s.jsx(v,{fullWidth:!0,type:"submit",variant:"contained",color:"primary",disabled:l||c,children:l||c?"Salvataggio...":"Salva Tag"})})]})})}function ee(){const e=S();return f({mutationFn:async()=>(await T.get("/tags-import")).data,onSuccess:()=>{e.invalidateQueries({queryKey:["tags"]})}})}function se(){return f({mutationFn:async()=>{const e=await T.get("/tag-essenziali-export",{responseType:"blob"}),n=window.URL.createObjectURL(new Blob([e.data])),i=document.createElement("a");i.href=n,i.setAttribute("download","tags-export.xlsx"),document.body.appendChild(i),i.click(),i.remove()}})}const ne=[{id:"id",label:"ID"},{id:"id_w",label:"ID_W"},{id:"name",label:"Nome"},{id:"slug",label:"Slug"},{id:"woocommerce",label:"Su WooCommerce"},{id:"last_sync",label:"Ultimo Sync"},{id:"actions",label:""}];function ie(){const{data:e,isFetching:n,isRefetching:i}=J(),{isPending:u}=M(),[t,p]=b.useState(!1),[a,l]=b.useState(null),{mutate:x,isPending:c}=ee(),{mutate:j,isPending:o}=se(),{showMessage:m}=K(),W=()=>{x(void 0,{onSuccess:()=>{m({text:"Tags sincronizzati con successo",type:"success"})}})},w=y=>{l(y||null),p(!0)},I=()=>{p(!1),l(null)},P=async y=>{I()},O=()=>{j(void 0,{onSuccess:()=>{m({text:"Tags esportati con successo",type:"success"})}})};return s.jsxs(V,{children:[s.jsxs(_,{display:"flex",alignItems:"center",mb:2,children:[s.jsxs(q,{variant:"h4",flexGrow:1,children:["Lista Tags (",(e==null?void 0:e.length)||0,")"]}),s.jsxs(_,{display:"flex",gap:1,children:[s.jsx(v,{variant:"contained",color:"secondary",startIcon:s.jsx(h,{icon:"material-symbols:sync"}),onClick:W,disabled:c,children:"Sincronizza WooCommerce"}),s.jsx(v,{variant:"contained",color:"success",startIcon:s.jsx(h,{icon:"vscode-icons:file-type-excel"}),onClick:O,disabled:o,children:"Export Tags"}),s.jsx(v,{variant:"contained",color:"inherit",startIcon:s.jsx(h,{icon:"mingcute:add-line"}),onClick:()=>w(),children:"Nuovo tag"})]})]}),s.jsx(H,{open:t,onClose:I,title:a?`Tag: ${a.name}`:"Nuovo Tag",onConfirm:P,maxWidth:"xs",children:s.jsx(Z,{tag:a,onSubmit:P})}),s.jsx(A,{isLoading:n||i||u||c||o,data:e||[],columns:ne,showCheckbox:!1,renderRow:(y,z)=>s.jsx(X,{row:y,selected:z,onEdit:w},y.id)})]})}function te(){return s.jsx(ie,{})}export{te as default};
