import{k as G,l as $,s as T,r as p,x as X,_ as Q,o as g,j as e,z as V,E as q,T as a,af as ee,ax as te,a as se,B as I,C as D,a9 as ae,ay as ie,az as re,aA as ne,e as z,h as O,aB as oe,ao as y,aC as H,aD as le,aE as Z,aF as L,a0 as S,a1 as s,aG as F,R as ce,ab as A,aH as de,c as k}from"./index-DXEjXkez.js";function pe(n){return G("MuiCardContent",n)}$("MuiCardContent",["root"]);const xe=["className","component"],he=n=>{const{classes:i}=n;return q({root:["root"]},pe,i)},me=T("div",{name:"MuiCardContent",slot:"Root",overridesResolver:(n,i)=>i.root})(()=>({padding:16,"&:last-child":{paddingBottom:24}})),B=p.forwardRef(function(i,m){const o=X({props:i,name:"MuiCardContent"}),{className:C,component:c="div"}=o,f=Q(o,xe),x=g({},o,{component:c}),d=he(x);return e.jsx(me,g({as:c,className:V(d.root,C),ownerState:x,ref:m},f))});function je(n){return G("MuiCardHeader",n)}const U=$("MuiCardHeader",["root","avatar","action","content","title","subheader"]),ue=["action","avatar","className","component","disableTypography","subheader","subheaderTypographyProps","title","titleTypographyProps"],ge=n=>{const{classes:i}=n;return q({root:["root"],avatar:["avatar"],action:["action"],content:["content"],title:["title"],subheader:["subheader"]},je,i)},Ce=T("div",{name:"MuiCardHeader",slot:"Root",overridesResolver:(n,i)=>g({[`& .${U.title}`]:i.title,[`& .${U.subheader}`]:i.subheader},i.root)})({display:"flex",alignItems:"center",padding:16}),fe=T("div",{name:"MuiCardHeader",slot:"Avatar",overridesResolver:(n,i)=>i.avatar})({display:"flex",flex:"0 0 auto",marginRight:16}),ve=T("div",{name:"MuiCardHeader",slot:"Action",overridesResolver:(n,i)=>i.action})({flex:"0 0 auto",alignSelf:"flex-start",marginTop:-4,marginRight:-8,marginBottom:-4}),ze=T("div",{name:"MuiCardHeader",slot:"Content",overridesResolver:(n,i)=>i.content})({flex:"1 1 auto"}),w=p.forwardRef(function(i,m){const o=X({props:i,name:"MuiCardHeader"}),{action:C,avatar:c,className:f,component:x="div",disableTypography:d=!1,subheader:R,subheaderTypographyProps:v,title:N,titleTypographyProps:P}=o,E=Q(o,ue),h=g({},o,{component:x,disableTypography:d}),l=ge(h);let j=N;j!=null&&j.type!==a&&!d&&(j=e.jsx(a,g({variant:c?"body2":"h5",className:l.title,component:"span",display:"block"},P,{children:j})));let u=R;return u!=null&&u.type!==a&&!d&&(u=e.jsx(a,g({variant:c?"body2":"body1",className:l.subheader,color:"text.secondary",component:"span",display:"block"},v,{children:u}))),e.jsxs(Ce,g({className:V(l.root,f),as:x,ref:m,ownerState:h},E,{children:[c&&e.jsx(fe,{className:l.avatar,ownerState:h,children:c}),e.jsxs(ze,{className:l.content,ownerState:h,children:[j,u]}),C&&e.jsx(ve,{className:l.action,ownerState:h,children:C})]}))}),be=()=>{const[n,i]=p.useState(!1),[m,o]=p.useState(!1),[C,c]=p.useState({}),[f,x]=p.useState([]),[d,R]=p.useState(0),[v,N]=p.useState(10),[P,E]=p.useState(""),{showMessage:h}=ee(),l=te.useRef(null),{data:j=[],refetch:u}=se({queryKey:["imports"],queryFn:async()=>(await k.get("/imports")).data.data}),W=[{sku:"302-1345-24",prezzo:"90",prezzo_scontato:"60",data_inizio_sconti:"02/03/2024",data_fine_sconti:"12/03/2024",nome_prodotto:"Piastra sospensione con cuscinetto",descrizione_breve:"piatto, zincato, con cuscinetto 1",descrizione_lunga:"Descrizione lunga..",categorie:"1,3,7",immagini:"example.jpg,example-2,jpg",stato:"pubblicato",stato_magazzino:"1",classe_spedizione:"classe-1"}],K=async t=>{var r;try{i(!0),x([]);const b=(r=t.target.files)==null?void 0:r[0];if(!b)return;const M=new FormData;M.append("prodotti_file",b);const J={"Content-Type":"multipart/form-data"},Y=await k.post("/excel-prodotti-import",M,{headers:J});c(Y.data),h({text:"Importazione completata",type:"success"}),await u(),l.current&&(l.current.value=""),o(!0)}catch{h({text:"Errore durante l'importazione",type:"error"}),x(["Errore durante l'importazione"])}finally{i(!1)}},_=j.filter(t=>{const r=P.toLowerCase();return t.id.toString().includes(r)||t.created_at.toLowerCase().includes(r)}).sort((t,r)=>r.id-t.id);return e.jsxs(I,{id:"prodotti-import-excel",p:2,children:[n&&e.jsx(I,{position:"fixed",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"rgba(255,255,255,0.8)",zIndex:9999,children:e.jsxs(D,{sx:{p:5},children:[e.jsx(a,{variant:"h5",children:"Importazione prodotti in corso"}),e.jsx(a,{children:"Potrebbe volerci un po di tempo .. Non chiudere o ricaricare la pagina"}),e.jsx(ae,{sx:{mt:2}})]})}),e.jsxs(ie,{open:m,onClose:()=>o(!1),children:[e.jsx(re,{children:"Importazione completata"}),e.jsxs(ne,{children:[e.jsx(z,{icon:"mdi:check-circle",color:"success",width:"40",height:"40"}),Object.entries(C).map(([t,r])=>e.jsxs(a,{children:[t,": ",e.jsx("strong",{children:r})]},t)),e.jsx(O,{component:oe,to:"/prodotti",variant:"contained",sx:{mt:3},startIcon:e.jsx(z,{icon:"mdi:package"}),children:"Vai alla lista prodotti"})]})]}),e.jsxs(D,{children:[e.jsx(w,{title:"Importatore XLSX prodotti"}),e.jsxs(B,{children:[e.jsxs(y,{severity:"success",children:["Struttura excel e nomi delle colonne ",e.jsx("strong",{children:"(aggiornato al 3 marzo)"})]}),e.jsx(O,{startIcon:e.jsx(z,{icon:"mdi:download"}),onClick:()=>window.location.href="https://api-xyzmars.accessoriportoni.express/import/example-excel/example.xlsx",variant:"contained",color:"info",sx:{my:3},children:"Scarica Excel di esempio"}),e.jsxs(I,{sx:{mb:3,p:2,bgcolor:"#f5f5f5",borderRadius:1},children:[e.jsx(a,{variant:"subtitle1",sx:{mb:2},children:"Lista delle colonne (clicca per copiare):"}),e.jsx("ol",{style:{paddingLeft:"20px"},children:["CODICE ARTICOLO","PREZZO","PREZZO SCONTATO","DATA INIZIO SCONTI","DATA FINE SCONTI","NOME PRODOTTO (H1)","DESCRIZIONE BREVE (laterale)","DESCRIZIONE LUNGA","ID-CAT (separatore: virgola)","IMMAGINI","Stato (pubblicato / bozza)","STATUS MAGAZZINO","CLASSE SPED"].map((t,r)=>e.jsx("li",{style:{marginBottom:"8px"},children:e.jsx(O,{size:"small",variant:"outlined",onClick:()=>navigator.clipboard.writeText(t),endIcon:e.jsx(z,{icon:"mdi:content-copy"}),sx:{textTransform:"none"},children:t})},r))})]}),e.jsx(H,{component:le,sx:{border:"3px solid red"},children:e.jsxs(Z,{children:[e.jsx(L,{children:e.jsxs(S,{children:[e.jsx(s,{size:"small",children:e.jsx(a,{variant:"caption",children:"CODICE ARTICOLO"})}),e.jsx(s,{size:"small",children:e.jsx(a,{variant:"caption",children:"PREZZO"})}),e.jsx(s,{size:"small",children:e.jsx(a,{variant:"caption",children:"PREZZO SCONTATO"})}),e.jsx(s,{size:"small",children:e.jsx(a,{variant:"caption",children:"DATA INIZIO SCONTI"})}),e.jsx(s,{size:"small",children:e.jsx(a,{variant:"caption",children:"DATA FINE SCONTI"})}),e.jsx(s,{size:"small",children:e.jsx(a,{variant:"caption",children:"NOME PRODOTTO (H1)"})}),e.jsx(s,{size:"small",children:e.jsx(a,{variant:"caption",children:"DESCRIZIONE BREVE (laterale)"})}),e.jsx(s,{size:"small",children:e.jsx(a,{variant:"caption",children:"DESCRIZIONE LUNGA"})}),e.jsx(s,{size:"small",children:e.jsx(a,{variant:"caption",children:"ID-CAT (separatore: virgola)"})}),e.jsx(s,{size:"small",children:e.jsx(a,{variant:"caption",children:"IMMAGINI"})}),e.jsx(s,{size:"small",children:e.jsx(a,{variant:"caption",children:"Stato (pubblicato / bozza)"})}),e.jsx(s,{size:"small",children:e.jsx(a,{variant:"caption",children:"STATUS MAGAZZINO"})}),e.jsx(s,{size:"small",children:e.jsx(a,{variant:"caption",children:"CLASSE SPED"})})]})}),e.jsx(F,{children:W.map(t=>e.jsxs(S,{children:[e.jsx(s,{children:t.sku}),e.jsx(s,{children:t.prezzo}),e.jsx(s,{children:t.prezzo_scontato}),e.jsx(s,{children:t.data_inizio_sconti}),e.jsx(s,{children:t.data_fine_sconti}),e.jsx(s,{children:t.nome_prodotto}),e.jsx(s,{children:t.descrizione_breve}),e.jsx(s,{children:t.descrizione_lunga}),e.jsx(s,{children:t.categorie}),e.jsx(s,{children:t.immagini}),e.jsx(s,{children:t.stato}),e.jsx(s,{children:t.stato_magazzino}),e.jsx(s,{children:t.classe_spedizione})]},t.sku))})]})}),e.jsxs(y,{severity:"warning",sx:{mt:2},children:[e.jsx(a,{children:e.jsx("strong",{children:"Legenda Status Magazzino"})}),"1 = disponbile | 2 = ordini arretrati | 0 = esaurito"]}),e.jsxs(y,{severity:"info",sx:{mt:2},children:[e.jsx(a,{children:e.jsx("strong",{children:"Gestione Magazzino"})}),"Tutti i prodotti importati avranno la gestione magazzino impostata su OFF"]}),e.jsxs(y,{severity:"warning",sx:{mt:2},children:[e.jsx(a,{children:e.jsx("strong",{children:"Informazioni Prodotti in Bozza"})}),'Per i prodotti in stato "bozza", lo slug del prodotto non verrÃ  generato automaticamente']}),e.jsxs(I,{component:"form",onSubmit:t=>t.preventDefault(),children:[f.length>0&&e.jsx(y,{severity:"error",children:e.jsx("ul",{children:f.map((t,r)=>e.jsx("li",{children:t},r))})}),e.jsx(I,{sx:{mt:4},children:e.jsxs(O,{component:"label",variant:"contained",startIcon:e.jsx(z,{icon:"mdi:cloud-upload"}),children:["Carica file XLSX",e.jsx("input",{type:"file",hidden:!0,accept:".xlsx",onChange:K,ref:l})]})})]})]})]}),e.jsxs(D,{sx:{mt:3},children:[e.jsx(w,{title:"Storico importazioni"}),e.jsxs(B,{children:[e.jsx(ce,{label:"Cerca in tutti i campi",variant:"outlined",size:"small",fullWidth:!0,value:P,onChange:t=>E(t.target.value),InputProps:{startAdornment:e.jsx(z,{icon:"mdi:magnify"})},sx:{mb:2}}),e.jsx(H,{children:e.jsxs(Z,{size:"small",children:[e.jsx(L,{children:e.jsxs(S,{children:[e.jsx(s,{children:"Import ID"}),e.jsx(s,{children:"Data import"}),e.jsx(s,{children:"Righe totali"}),e.jsx(s,{children:"Righe importate"}),e.jsx(s,{children:"Righe Fallite"}),e.jsx(s,{children:"Prodotti Falliti"})]})}),e.jsx(F,{children:_.length===0?e.jsx(S,{children:e.jsx(s,{colSpan:6,align:"center",children:"Nessun import trovato"})}):_.slice(d*v,d*v+v).map(t=>e.jsxs(S,{children:[e.jsx(s,{children:t.id}),e.jsx(s,{children:t.created_at}),e.jsx(s,{children:e.jsx(A,{title:t.righe.toString(),color:"info",sx:{textAlign:"center",p:.5,width:"40px"}})}),e.jsx(s,{children:e.jsx(A,{title:t.righe_importate.toString(),color:"success",sx:{textAlign:"center",p:.5,width:"40px"}})}),e.jsx(s,{children:t.righe_fallite>0?e.jsx(A,{title:t.righe_fallite.toString(),color:"error",sx:{textAlign:"center",p:.5,width:"40px"}}):e.jsx(A,{title:t.righe_fallite.toString(),color:"info",sx:{textAlign:"center",p:.5,width:"40px"}})}),e.jsx(s,{children:t.prodotti_falliti})]},t.id))})]})}),e.jsx(de,{component:"div",count:_.length,page:d,onPageChange:(t,r)=>R(r),rowsPerPage:v,onRowsPerPageChange:t=>{N(parseInt(t.target.value,10)),R(0)},rowsPerPageOptions:[10,25,50],labelDisplayedRows:({from:t,to:r,count:b})=>`Mostra da ${t} a ${r} delle ${b} righe`,labelRowsPerPage:"Righe per pagina:"})]})]})]})};function ye(){return e.jsx(e.Fragment,{children:e.jsx(be,{})})}export{ye as default};
