import{r as g,f as D,j as e,a0 as R,a1 as s,a3 as u,I as r,a4 as T,P as L,N,O as _,Q as f,a9 as I,a as U,c as k,a7 as z,a8 as M,af as $,D as q,B as E,T as B,h as P,ag as G,a5 as Q,H as K,g as W}from"./index-DXEjXkez.js";import{u as A,P as H}from"./prodotto-form-BX8xmiXc.js";import"./quill.snow-BZ8VsIS9.js";import"./useGetTags-CXGUoUDx.js";import"./Autocomplete-Xo0vid0L.js";function V({row:t,selected:p,onEdit:h,onViewDetails:m}){const[i,o]=g.useState(null),{mutate:n,isPending:l}=A(t.id),c=D(),x=g.useCallback(a=>{o(a.currentTarget)},[]),d=g.useCallback(()=>{o(null)},[]),b=a=>{n({force:a},{onSuccess:()=>{d()},onError:()=>{d()}})},y=()=>{d(),c(`/prodotti/${t.id}`)};return e.jsxs(e.Fragment,{children:[e.jsxs(R,{hover:!0,tabIndex:-1,role:"checkbox",selected:p,sx:{...t.deleted&&{bgcolor:"error.lighter","&:hover":{bgcolor:"error.light"}}},children:[e.jsx(s,{children:t.id}),e.jsx(s,{children:t.id_w||"-"}),e.jsx(s,{children:t.sku||"-"}),e.jsx(s,{children:t.name}),e.jsx(s,{align:"center",children:t.immagine_principale?e.jsx("img",{src:`https://api-xyzmars.accessoriportoni.express/front/${t.immagine_principale.src}`,alt:t.name,style:{width:"30px",height:"auto"}}):"-"}),e.jsx(s,{children:e.jsx(u,{color:t.type==="simple"?"secondary":"info",children:t.type})}),e.jsx(s,{children:t.created_at}),e.jsx(s,{children:t.updated_at_con_ora}),e.jsx(s,{align:"center",children:t.deleted?e.jsx(u,{color:"error",children:"SI"}):"-"}),e.jsx(s,{children:e.jsx(u,{color:t.status==="publish"?"success":t.status==="draft"?"warning":"error",children:t.status==="publish"?"Pubblicato":t.status==="draft"?"Bozza":"Cestino"})}),e.jsx(s,{align:"center",children:e.jsx(u,{color:t.stock_status==="instock"?"success":t.stock_status==="onbackorder"?"warning":"error",children:e.jsx(r,{icon:t.stock_status==="outofstock"?"eva:alert-triangle-fill":"eva:checkmark-fill"})})}),e.jsx(s,{align:"center",children:t.on_sale?e.jsx(u,{color:"info",children:"SI"}):"-"}),e.jsx(s,{children:t.last_sync?e.jsxs(u,{color:t.last_sync.stato==="successo"?"info":"error",children:["Sync-",t.last_sync.id]}):"-"}),e.jsx(s,{children:t.last_export?e.jsxs(u,{color:t.last_export.stato==="successo"?"info":"error",children:["Export-",t.last_export.id]}):"-"}),e.jsx(s,{sx:{position:"sticky",right:0,backgroundColor:a=>`rgba(${a.palette.background.paper}, 0.8)`,backdropFilter:"blur(6px)",boxShadow:"-2px 0 4px rgba(0,0,0,0.1)",zIndex:1,width:"30px"},children:e.jsx(T,{onClick:x,children:e.jsx(r,{icon:"eva:more-vertical-fill"})})})]}),e.jsx(L,{open:!!i,anchorEl:i,onClose:d,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"right"},children:e.jsxs(N,{disablePadding:!0,sx:{p:.5,gap:.5,width:200,display:"flex",flexDirection:"column",[`& .${_.root}`]:{px:1,gap:2,borderRadius:.75,[`&.${_.selected}`]:{bgcolor:"action.selected"}}},children:[e.jsxs(f,{onClick:y,children:[e.jsx(r,{icon:"solar:pen-bold"}),"Modifica"]}),t.status==="trash"||t.deleted?e.jsx(f,{onClick:()=>b(!0),sx:{color:"error.main"},children:l?e.jsx(I,{size:20}):e.jsxs(e.Fragment,{children:[e.jsx(r,{icon:"solar:trash-bin-trash-bold"}),"Elimina definitivamente"]})}):e.jsx(f,{onClick:()=>b(!1),sx:{color:"warning.main"},children:l?e.jsx(I,{size:20}):e.jsxs(e.Fragment,{children:[e.jsx(r,{icon:"solar:trash-bin-trash-bold"}),"Sposta nel cestino"]})})]})})]})}const J=async()=>{const{data:t}=await k.get("prodotti");return t.data},X=()=>U({queryKey:["prodotti"],queryFn:J});function Y(){const t=z();return M({mutationFn:async()=>(await k.get("/prodotti-import")).data,onSuccess:()=>{t.invalidateQueries({queryKey:["prodotti"]})}})}function Z(){const t=z();return M({mutationFn:async(p=[])=>{var l,c;const h=await k.get("/prodotti-essenziali-export",{responseType:"blob",params:{arrayProdottiSelezionatiId:[1555]}}),m=h.headers["content-disposition"];let i="export.xlsx";if(m){const x=(c=(l=m.split(";")[1])==null?void 0:l.split("=")[1])==null?void 0:c.replace(/\"/g,"");x&&(i=x)}const o=window.URL.createObjectURL(new Blob([h.data])),n=document.createElement("a");return n.href=o,n.setAttribute("download",i),document.body.appendChild(n),n.click(),setTimeout(()=>{document.body.removeChild(n),window.URL.revokeObjectURL(o)},100),{success:!0}},onSuccess:()=>{t.invalidateQueries({queryKey:["prodotti"]})}})}const w=[{id:"id",label:"ID"},{id:"id_w",label:"ID_W"},{id:"sku",label:"SKU"},{id:"name",label:"Nome"},{id:"immagine",label:"Immagine"},{id:"type",label:"Tipo"},{id:"created_at",label:"Pubblicato"},{id:"updated_at",label:"Modificato"},{id:"deleted",label:"Eliminato"},{id:"status",label:"Stato"},{id:"stock_status",label:"Stock"},{id:"on_sale",label:"Saldo"},{id:"last_sync",label:"Ultimo Sync"},{id:"last_export",label:"Ultimo Export"},{id:"actions",label:""}];function ee(){var S;const{data:t,isFetching:p,isRefetching:h}=X(),[m,i]=g.useState(!1),[o,n]=g.useState(null),{mutate:l,isPending:c}=Y(),{mutate:x,isPending:d}=Z(),{showMessage:b}=$(),y=()=>{l(void 0,{onSuccess:()=>{b({text:"Prodotti sincronizzati con successo",type:"success"})}})},a=j=>{n(j||null),i(!0)},v=()=>{i(!1),n(null)},C=async j=>{v()},F=()=>{x(void 0,{onSuccess:()=>{b({text:"Prodotti esportati con successo",type:"success"})}})};return e.jsxs(q,{children:[e.jsxs(E,{display:"flex",alignItems:"center",mb:2,children:[e.jsxs(B,{variant:"h4",flexGrow:1,children:["Lista Prodotti (",(t==null?void 0:t.length)||0,")"]}),e.jsxs(E,{display:"flex",gap:1,children:[e.jsx(P,{variant:"contained",color:"secondary",startIcon:e.jsx(r,{icon:"material-symbols:sync"}),onClick:y,disabled:c,children:"Sincronizza WooCommerce"}),e.jsx(P,{variant:"contained",color:"success",startIcon:e.jsx(r,{icon:"vscode-icons:file-type-excel"}),onClick:F,disabled:d,children:"Export Prodotti"}),e.jsx(P,{variant:"contained",color:"inherit",startIcon:e.jsx(r,{icon:"mingcute:add-line"}),onClick:()=>a(),children:"Nuovo Prodotto"})]})]}),e.jsx(G,{open:m,onClose:v,onConfirm:C,maxWidth:"xl",children:e.jsx(H,{prodotto:o,prodottoId:((S=o==null?void 0:o.id)==null?void 0:S.toString())||"",onSubmit:C})}),e.jsx(Q,{isLoading:p||h||c||d,data:t||[],columns:w,showCheckbox:!0,renderRow:(j,O)=>e.jsx(V,{row:j,selected:O,onEdit:a},j.id)})]})}function ae(){return e.jsxs(e.Fragment,{children:[e.jsx(K,{children:e.jsxs("title",{children:[" ",`Prodotti - ${W.appName}`]})}),e.jsx(ee,{})]})}export{ae as default};
