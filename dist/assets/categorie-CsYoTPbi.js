import{a as M,c as h,a7 as w,a8 as f,r as S,j as n,a0 as z,a1 as r,a2 as T,B as _,a3 as D,a4 as $,I as p,P as G,N,O as q,Q as F,a9 as Q,aa as R,G as a,T as O,ab as k,R as v,ac as L,ad as K,ae as U,h as I,af as B,D as V,ag as A,a5 as H}from"./index-DXEjXkez.js";const J=async()=>{const{data:e}=await h.get("categorie");return e.data},W=()=>M({queryKey:["categorie"],queryFn:J}),X=()=>{const e=w();return f({mutationFn:async s=>(await h.delete(`/categorie/${s}`)).data,onSuccess:()=>{e.invalidateQueries({queryKey:["categorie"]})}})};function Y({key:e,row:s,selected:t,onSelectRow:i,onOpenProducts:u,onEdit:o}){const[d,j]=S.useState(null),{mutate:y,isPending:m}=X(),C=S.useCallback(x=>{j(x.currentTarget)},[]),c=S.useCallback(()=>{j(null)},[]),b=()=>{confirm("Sei sicuro di voler eliminare questa categoria?")&&y(s.id)},P=()=>{c(),o(s)};return n.jsxs(n.Fragment,{children:[n.jsxs(z,{hover:!0,tabIndex:-1,role:"checkbox",selected:t,children:[i&&n.jsx(r,{padding:"checkbox",children:n.jsx(T,{disableRipple:!0,checked:t,onChange:i})}),n.jsx(r,{children:s.id}),n.jsx(r,{children:s.id_w||"-"}),n.jsx(r,{children:s.name}),n.jsx(r,{children:s.slug}),n.jsx(r,{children:s.genitore?s.genitore.name:"-"}),n.jsx(r,{children:s.immagine?n.jsx(_,{display:"flex",justifyContent:"center",children:n.jsx("img",{src:`https://api-xyzmars.accessoriportoni.express${s.immagine.src}`,alt:s.name,style:{width:50}})}):"-"}),n.jsx(r,{children:n.jsx(D,{color:s.id_w?"info":"error",children:s.id_w?"SI ✓":"NO ⚠"})}),n.jsx(r,{children:s.last_sync?n.jsxs(D,{color:s.last_sync.stato==="successo"?"success":"error",children:["Sync-",s.last_sync.id]}):"-"}),n.jsx(r,{align:"right",children:n.jsx($,{onClick:C,children:n.jsx(p,{icon:"eva:more-vertical-fill"})})})]}),n.jsx(G,{open:!!d,anchorEl:d,onClose:c,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"right"},children:n.jsxs(N,{disablePadding:!0,sx:{p:.5,gap:.5,width:140,display:"flex",flexDirection:"column",[`& .${q.root}`]:{px:1,gap:2,borderRadius:.75,[`&.${q.selected}`]:{bgcolor:"action.selected"}}},children:[n.jsxs(F,{onClick:P,children:[n.jsx(p,{icon:"solar:pen-bold"}),"Modifica"]}),n.jsx(F,{onClick:b,sx:{color:"error.main"},children:m?n.jsx(Q,{size:20}):n.jsxs(n.Fragment,{children:[n.jsx(p,{icon:"solar:trash-bin-trash-bold"}),"Elimina"]})})]})})]})}function Z(){const e=w();return f({mutationFn:async s=>{const{data:t}=await h.put(`/categorie/${s.id}`,s);return t},onSuccess:()=>{e.invalidateQueries({queryKey:["categorie"]})}})}function ee(){const e=w();return f({mutationFn:async s=>{const{data:t}=await h.post("/categorie",s);return t},onSuccess:()=>{e.invalidateQueries({queryKey:["categorie"]})}})}const ne=()=>{const e=w();return f({mutationFn:async t=>{var o;const i=new FormData;i.append("categoria_id",t.categoria_id),t.categoria_immagine_principale&&i.append("immagine_principale",t.categoria_immagine_principale),(o=t.categoria_immagini)!=null&&o.length&&t.categoria_immagini.forEach(d=>{i.append("categoria_immagini[]",d)});const u={"Content-Type":"multipart/form-data"};return h.post("/categoria/immagini/salva",i,{headers:u})},onSuccess:()=>{e.invalidateQueries({queryKey:["categorie"]})},onError:()=>{}})};function se({categoria:e,onSubmit:s,onDelete:t}){const{register:i,handleSubmit:u,formState:{errors:o},setValue:d,watch:j}=R({defaultValues:{name:(e==null?void 0:e.name)||"",slug:(e==null?void 0:e.slug)||"",id:(e==null?void 0:e.id)||"",id_w:(e==null?void 0:e.id_w)||"",parent:(e==null?void 0:e.parent)||null,description:(e==null?void 0:e.description)||"",immagine:(e==null?void 0:e.immagine)||null,created_at_con_ora:(e==null?void 0:e.created_at_con_ora)||"",last_sync:(e==null?void 0:e.last_sync)||null,on_sale:(e==null?void 0:e.on_sale)||!1,date_on_sale_from:(e==null?void 0:e.date_on_sale_from)||null,date_on_sale_to:(e==null?void 0:e.date_on_sale_to)||null,sale_percentage:(e==null?void 0:e.sale_percentage)||null}}),{mutate:y,isPending:m}=ee(),{mutate:C,isPending:c}=Z(),{mutate:b,isPending:P}=ne(),{data:x}=W(),E=async l=>{e?C({...e,...l},{onSuccess:()=>{s(l),b({categoria_id:e.id.toString(),categoria_immagine_principale:l.immagine})},onError:g=>{console.error("Errore durante il salvataggio della categoria:",g)}}):y(l,{onSuccess:()=>s(l),onError:g=>{console.error("Errore durante il salvataggio della categoria:",g)}})};return n.jsxs("form",{onSubmit:u(E),children:[n.jsxs(a,{container:!0,spacing:2,children:[(e==null?void 0:e.id)&&n.jsxs(a,{item:!0,xs:12,children:[n.jsxs(_,{sx:{mb:2},children:[n.jsxs(O,{variant:"body2",sx:{mb:2},children:["Data di creazione: ",e.created_at_con_ora]}),e.id_w!==null?n.jsx(k,{sx:{width:"100%"},title:`Caricata su WooCommerce: ${e.id_w?"SI":"NO"}`,color:"success"}):n.jsx(k,{sx:{width:"100%"},title:`Caricata su WooCommerce: ${e.id_w?"SI":"NO"}`,color:"error"})]}),n.jsx(_,{children:e.last_sync&&n.jsx(k,{sx:{width:"100%"},title:`Ultimo Sync ${e.last_sync.id}`,subtitle:`Data: ${e.last_sync.created_at}`,color:e.last_sync.stato==="successo"?"info":"error"})})]}),(e==null?void 0:e.id)&&n.jsxs(n.Fragment,{children:[n.jsx(a,{item:!0,xs:12,md:6,children:n.jsx(v,{fullWidth:!0,label:"ID",...i("id"),disabled:!0})}),n.jsx(a,{item:!0,xs:12,md:6,children:n.jsx(v,{fullWidth:!0,label:"ID_W",...i("id_w"),disabled:!0})})]}),n.jsx(a,{item:!0,xs:12,md:12,children:n.jsx(v,{fullWidth:!0,label:"Nome categoria",...i("name",{required:!0}),error:!!o.name,helperText:o.name&&"Il nome è obbligatorio"})}),(e==null?void 0:e.id)&&n.jsx(a,{item:!0,xs:12,md:12,children:n.jsx(v,{fullWidth:!0,label:"Slug",...i("slug")})}),n.jsx(a,{item:!0,xs:12,md:12,children:n.jsxs(L,{fullWidth:!0,children:[n.jsx(K,{id:"parent-label",children:"Categoria Genitore"}),n.jsx(U,{labelId:"parent-label",label:"Categoria Genitore",...i("parent"),value:j("parent")||"",children:x==null?void 0:x.map(l=>n.jsx(F,{value:l.id_w,children:l.name},l.id_w))})]})}),n.jsx(a,{item:!0,xs:12,children:n.jsx(v,{fullWidth:!0,label:"Descrizione",...i("description"),multiline:!0,rows:4})})]}),n.jsx(a,{item:!0,xs:12,sx:{mt:2},children:n.jsxs(_,{sx:{display:"flex",gap:2,justifyContent:"flex-end"},children:[(e==null?void 0:e.id)&&t&&n.jsx(I,{color:"error",variant:"contained",onClick:()=>t(e.id),startIcon:n.jsx(p,{icon:"solar:trash-bin-trash-bold"}),children:"Elimina categoria"}),n.jsx(I,{fullWidth:!0,type:"submit",variant:"contained",color:"primary",disabled:m||c,children:m||c?"Salvataggio...":"Salva Categoria"})]})})]})}function te(){const e=w();return f({mutationFn:async()=>(await h.get("/categorie-import")).data,onSuccess:()=>{e.invalidateQueries({queryKey:["categorie"]})}})}function ie(){return f({mutationFn:async()=>{const e=await h.get("/categorie-essenziali-export",{responseType:"blob"}),s=window.URL.createObjectURL(new Blob([e.data])),t=document.createElement("a");t.href=s,t.setAttribute("download","categories-export.xlsx"),document.body.appendChild(t),t.click(),t.remove()}})}function le(){const{data:e}=W(),[s,t]=S.useState(!1),[i,u]=S.useState(null),{mutate:o,isPending:d}=te(),{mutate:j,isPending:y}=ie(),{showMessage:m}=B(),C=l=>{u(l||null),t(!0)},c=()=>{t(!1),u(null)},b=async l=>{c()},P=()=>{o(void 0,{onSuccess:()=>{m({text:"Categorie sincronizzate con successo",type:"success"})}})},x=()=>{j(void 0,{onSuccess:()=>{m({text:"Categorie esportate con successo",type:"success"})}})},E=[{id:"id",label:"ID"},{id:"id_w",label:"ID_W"},{id:"name",label:"Nome"},{id:"slug",label:"Slug"},{id:"genitore",label:"Cat genitore"},{id:"immagine",label:"Immagine"},{id:"wordpress",label:"Su Woo"},{id:"sync",label:"Sync"},{id:"actions",label:""}];return n.jsxs(V,{children:[n.jsxs(_,{display:"flex",alignItems:"center",mb:2,flexDirection:{xs:"column",md:"row"},gap:1,children:[n.jsxs(O,{variant:"h4",flexGrow:1,children:["Categorie (",(e==null?void 0:e.length)||0,")"]}),n.jsxs(_,{display:"flex",flexDirection:{xs:"column",md:"row"},gap:1,children:[n.jsx(I,{sx:{width:{xs:"100%",md:"auto"}},variant:"contained",color:"secondary",startIcon:n.jsx(p,{icon:"material-symbols:sync"}),onClick:P,disabled:d,children:"Sincronizza WooCommerce"}),n.jsx(I,{sx:{width:{xs:"100%",md:"auto"}},variant:"contained",color:"success",startIcon:n.jsx(p,{icon:"vscode-icons:file-type-excel"}),onClick:x,disabled:y,children:"Export Categorie"}),n.jsx(I,{sx:{width:{xs:"100%",md:"auto"}},variant:"contained",color:"inherit",startIcon:n.jsx(p,{icon:"mingcute:add-line"}),onClick:()=>C(),children:"Nuova categoria"})]})]}),n.jsx(A,{open:s,onClose:c,title:i?`Categoria: ${i.name}`:"Nuova Categoria",onConfirm:b,maxWidth:"xs",children:n.jsx(se,{categoria:i,onSubmit:b})}),n.jsx(H,{data:e||[],columns:E,isLoading:d||y,renderRow:l=>n.jsx(Y,{row:l,selected:!1,onOpenProducts:()=>{alert("open products")},onEdit:g=>{C(g)}},l.id)})]})}function oe(){return n.jsx(n.Fragment,{children:n.jsx(le,{})})}export{oe as default};
